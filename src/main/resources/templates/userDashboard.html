<!DOCTYPE html>
<html>
<head>
    <title>User Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <span class="navbar-brand">User Dashboard</span>
        <button id="logoutBtn" class="btn btn-danger">Logout</button>
    </div>
</nav>

<div class="container my-4">
    <a href="raise-complaint.html" class="btn btn-primary mb-3">+ Raise Complaint</a>

    <table class="table table-bordered table-striped" id="complaintsTable">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Category</th>
                <th>Description</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dynamic complaints will appear here -->
        </tbody>
    </table>
</div>

<script>
const user = JSON.parse(localStorage.getItem('user')); // Assumes user info stored after login

if (!user) {
    window.location.href = 'login.html';
}

// Fetch complaints for this user
async function loadComplaints() {
    const response = await fetch('http://localhost:8080/api/complaints/user', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(user)
    });

    if (response.ok) {
        const complaints = await response.json();
        const tbody = document.querySelector('#complaintsTable tbody');
        tbody.innerHTML = '';

        complaints.forEach(c => {
            const statusClass = c.status === 'RESOLVED' ? 'bg-success' : 'bg-warning';
            tbody.innerHTML += `
                <tr>
                    <td>${c.id}</td>
                    <td>${c.category}</td>
                    <td>${c.description}</td>
                    <td><span class="badge ${statusClass}">${c.status}</span></td>
                </tr>
            `;
        });
    } else {
        alert('Failed to load complaints');
    }
}

loadComplaints();

// Logout functionality
document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('user');
    window.location.href = 'login.html';
});
</script>

</body>
</html>
